<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>幾A幾B</title>
    <style>
        .group{
            padding: 20px;
            width: 80%;
            box-sizing: border-box;
        }
        .input-group > .btn{
            width: 33.333333%;
        }
        .result_show{
            border: 1px solid #CED4DA;
            border-radius: 5px;
        }
        .guess{
            border-radius: 5px;
            border: 1px solid #CED4DA;
            background-color: #E9ECEF;
        }
    </style>
</head>
<body>
    <div class="group m-auto">
        <div class="input-group mb-3">
            <button class="btn btn-outline-secondary start" type="button">開始</button>
            <button class="btn btn-outline-secondary give_up" type="button">放棄重來</button>
            <button class="btn btn-outline-secondary look" type="button">看答案</button>
        </div>
    
        <div class="form-floating mb-3 result_show overflow-auto" style="height: 300px">
            <!-- <textarea class="form-control result_show" id="floatingTextarea2"></textarea> -->
        </div>
    
        <div class="input-group mb-3">
            <span class="input-group-text">猜答案</span>
            <input type="text" class="form-control" id="input_box">
            <button class="guess">猜!</button>
        </div>
    </div>
    
    <script>
        let result = document.querySelector(".result_show");
        let start = document.querySelector(".start");
        let giveup = document.querySelector(".give_up");
        let look = document.querySelector(".look");
        let guess = document.querySelector(".guess");
        let answer, input;
        let p, pinner, span;
        let answerArray = [];
        let tempArray = [];
        let p_c = 0;
        let m_c = 0;


        start.addEventListener("click", function(event){
            random();
            result.innerText = "";
            document.querySelector("#input_box").value = "";
        });

        giveup.addEventListener("click", function(event){
            result.innerText = "";
            document.querySelector("#input_box").value = "";
            random();
        })

        look.addEventListener("click", function(event){
            createp();
            pinner.innerText = `答案是 : ${answer}`;
            show_result();
        })

        guess.addEventListener("click", function(event){
            p_c = 0;
            m_c = 0;
            input = document.querySelector("#input_box").value;
            tempArray = input.split("", 4);
            createp();
            if (isRepeat(input.toString().split("", 4))){
                alert("數字重複，請重新輸入");
                document.querySelector("#input_box").value = "";
            }
            else if (checklength(input)){
                alert("格式不符合，請重新輸入 \"4\" 位數字");
                document.querySelector("#input_box").value = "";
            }
            else {
                span = document.createElement("span");
                let temp = judge();
                if (temp[0] == 4 && temp[2] == 0){
                    span.classList.add("me-3", "text-white", "py-1", "px-3", "rounded");
                    span.setAttribute("style", "background-color: #62BD60;");
                    p.append(span);
                    show_result();
                    setTimeout(function(){alert("恭喜猜中")}, 400);
                }
                else {
                    span.classList.add("me-3", "text-white", "py-1", "px-3", "rounded");
                    span.setAttribute("style", "background-color: #DD5754;");
                }
                span.innerText = temp;
                pinner.innerText = input;
                pinner.classList.add("d-inline");
                p.append(span);
                show_result();
            }
        })


        function checklength(string){
            if (string.length < 4 || string.length > 4){
                return true;
            }
            return false;
        }

        function createp(){
            p = document.createElement("p");
            pinner = document.createElement("p");
            p.classList.add("fs-5", "d-block", "border-bottom", "border-secondary", "mb-0", "py-1", "px-2");
            pinner.classList.add("mb-0");
        }

        function judge(){
            for (var i = 0; i < 4; i++){
                for (var j = 0; j < 4; j++){
                    if (i === j && answerArray[i] === tempArray[j]){
                        p_c += 1;
                    }
                    else if (i !== j && answerArray[i] === tempArray[j]){
                        m_c += 1;
                    }
                }
            }
            return `${p_c}A${m_c}B`;
        }

        function show_result(){
            p.append(pinner);
            result.append(p);
            document.querySelector("#input_box").value = "";
        }

        function random(){
            answer = getRandomInt(1234, 9876);
            answerArray = answer.toString().split("", 4);
            while (true){
                if (isRepeat(answer.toString().split("", 4))){
                    answer = getRandomInt(1234, 9876);
                }
                else{
                    break;
                }
            }
        }

        function isRepeat(array){
            var sample = array.sort();
            for(var i = 0; i < array.length; i++){
                if (sample[i] == sample[i+1]){
                    return true;
                    break;
                }
            }
            return false;
        }

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min) + min);
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>
